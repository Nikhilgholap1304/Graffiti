{"version":3,"file":"microbundle.js","sources":["../node_modules/babel-plugin-transform-async-to-promises/helpers.js","../src/utils.js","../src/lib/babel-custom.js","../src/log-error.js","../src/index.js"],"sourcesContent":["// A type of promise-like that resolves synchronously and supports only one observer\nexport const _Pact = /*#__PURE__*/(function() {\n\tfunction _Pact() {}\n\t_Pact.prototype.then = function(onFulfilled, onRejected) {\n\t\tconst result = new _Pact();\n\t\tconst state = this.s;\n\t\tif (state) {\n\t\t\tconst callback = state & 1 ? onFulfilled : onRejected;\n\t\t\tif (callback) {\n\t\t\t\ttry {\n\t\t\t\t\t_settle(result, 1, callback(this.v));\n\t\t\t\t} catch (e) {\n\t\t\t\t\t_settle(result, 2, e);\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t} else {\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}\n\t\tthis.o = function(_this) {\n\t\t\ttry {\n\t\t\t\tconst value = _this.v;\n\t\t\t\tif (_this.s & 1) {\n\t\t\t\t\t_settle(result, 1, onFulfilled ? onFulfilled(value) : value);\n\t\t\t\t} else if (onRejected) {\n\t\t\t\t\t_settle(result, 1, onRejected(value));\n\t\t\t\t} else {\n\t\t\t\t\t_settle(result, 2, value);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t_settle(result, 2, e);\n\t\t\t}\n\t\t};\n\t\treturn result;\n\t}\n\treturn _Pact;\n})();\n\n// Settles a pact synchronously\nexport function _settle(pact, state, value) {\n\tif (!pact.s) {\n\t\tif (value instanceof _Pact) {\n\t\t\tif (value.s) {\n\t\t\t\tif (state & 1) {\n\t\t\t\t\tstate = value.s;\n\t\t\t\t}\n\t\t\t\tvalue = value.v;\n\t\t\t} else {\n\t\t\t\tvalue.o = _settle.bind(null, pact, state);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tif (value && value.then) {\n\t\t\tvalue.then(_settle.bind(null, pact, state), _settle.bind(null, pact, 2));\n\t\t\treturn;\n\t\t}\n\t\tpact.s = state;\n\t\tpact.v = value;\n\t\tconst observer = pact.o;\n\t\tif (observer) {\n\t\t\tobserver(pact);\n\t\t}\n\t}\n}\n\nexport function _isSettledPact(thenable) {\n\treturn thenable instanceof _Pact && thenable.s & 1;\n}\n\n// Converts argument to a function that always returns a Promise\nexport function _async(f) {\n\treturn function() {\n\t\tfor (var args = [], i = 0; i < arguments.length; i++) {\n\t\t\targs[i] = arguments[i];\n\t\t}\n\t\ttry {\n\t\t\treturn Promise.resolve(f.apply(this, args));\n\t\t} catch(e) {\n\t\t\treturn Promise.reject(e);\n\t\t}\n\t}\n}\n\n// Awaits on a value that may or may not be a Promise (equivalent to the await keyword in ES2015, with continuations passed explicitly)\nexport function _await(value, then, direct) {\n\tif (direct) {\n\t\treturn then ? then(value) : value;\n\t}\n\tif (!value || !value.then) {\n\t\tvalue = Promise.resolve(value);\n\t}\n\treturn then ? value.then(then) : value;\n}\n\n// Awaits on a value that may or may not be a Promise, then ignores it\nexport function _awaitIgnored(value, direct) {\n\tif (!direct) {\n\t\treturn value && value.then ? value.then(_empty) : Promise.resolve();\n\t}\n}\n\n// Proceeds after a value has resolved, or proceeds immediately if the value is not thenable\nexport function _continue(value, then) {\n\treturn value && value.then ? value.then(then) : then(value);\n}\n\n// Proceeds after a value has resolved, or proceeds immediately if the value is not thenable\nexport function _continueIgnored(value) {\n\tif (value && value.then) {\n\t\treturn value.then(_empty);\n\t}\n}\n\n// Asynchronously iterate through an object that has a length property, passing the index as the first argument to the callback (even as the length property changes)\nexport function _forTo(array, body, check) {\n\tvar i = -1, pact, reject;\n\tfunction _cycle(result) {\n\t\ttry {\n\t\t\twhile (++i < array.length && (!check || !check())) {\n\t\t\t\tresult = body(i);\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\t\tresult = result.v;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.then(_cycle, reject || (reject = _settle.bind(null, pact = new _Pact(), 2)));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (pact) {\n\t\t\t\t_settle(pact, 1, result);\n\t\t\t} else {\n\t\t\t\tpact = result;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t_settle(pact || (pact = new _Pact()), 2, e);\n\t\t}\n\t}\n\t_cycle();\n\treturn pact;\n}\n\n// Asynchronously iterate through an object's properties (including properties inherited from the prototype)\n// Uses a snapshot of the object's properties\nexport function _forIn(target, body, check) {\n\tvar keys = [];\n\tfor (var key in target) {\n\t\tkeys.push(key);\n\t}\n\treturn _forTo(keys, function(i) { return body(keys[i]); }, check);\n}\n\n// Asynchronously iterate through an object's own properties (excluding properties inherited from the prototype)\n// Uses a snapshot of the object's properties\nexport function _forOwn(target, body, check) {\n\tvar keys = [];\n\tfor (var key in target) {\n\t\tif (Object.prototype.hasOwnProperty.call(target, key)) {\n\t\t\tkeys.push(key);\n\t\t}\n\t}\n\treturn _forTo(keys, function(i) { return body(keys[i]); }, check);\n}\n\nexport const _iteratorSymbol = /*#__PURE__*/ typeof Symbol !== \"undefined\" ? (Symbol.iterator || (Symbol.iterator = Symbol(\"Symbol.iterator\"))) : \"@@iterator\";\n\n// Asynchronously iterate through an object's values\n// Uses for...of if the runtime supports it, otherwise iterates until length on a copy\nexport function _forOf(target, body, check) {\n\tif (typeof target[_iteratorSymbol] === \"function\") {\n\t\tvar iterator = target[_iteratorSymbol](), step, pact, reject;\n\t\tfunction _cycle(result) {\n\t\t\ttry {\n\t\t\t\twhile (!(step = iterator.next()).done && (!check || !check())) {\n\t\t\t\t\tresult = body(step.value);\n\t\t\t\t\tif (result && result.then) {\n\t\t\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\t\t\tresult = result.v;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult.then(_cycle, reject || (reject = _settle.bind(null, pact = new _Pact(), 2)));\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (pact) {\n\t\t\t\t\t_settle(pact, 1, result);\n\t\t\t\t} else {\n\t\t\t\t\tpact = result;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t_settle(pact || (pact = new _Pact()), 2, e);\n\t\t\t}\n\t\t}\n\t\t_cycle();\n\t\tif (iterator.return) {\n\t\t\tvar _fixup = function(value) {\n\t\t\t\ttry {\n\t\t\t\t\tif (!step.done) {\n\t\t\t\t\t\titerator.return();\n\t\t\t\t\t}\n\t\t\t\t} catch(e) {\n\t\t\t\t}\n\t\t\t\treturn value;\n\t\t\t}\n\t\t\tif (pact && pact.then) {\n\t\t\t\treturn pact.then(_fixup, function(e) {\n\t\t\t\t\tthrow _fixup(e);\n\t\t\t\t});\n\t\t\t}\n\t\t\t_fixup();\n\t\t}\n\t\treturn pact;\n\t}\n\t// No support for Symbol.iterator\n\tif (!(\"length\" in target)) {\n\t\tthrow new TypeError(\"Object is not iterable\");\n\t}\n\t// Handle live collections properly\n\tvar values = [];\n\tfor (var i = 0; i < target.length; i++) {\n\t\tvalues.push(target[i]);\n\t}\n\treturn _forTo(values, function(i) { return body(values[i]); }, check);\n}\n\nexport const _asyncIteratorSymbol = /*#__PURE__*/ typeof Symbol !== \"undefined\" ? (Symbol.asyncIterator || (Symbol.asyncIterator = Symbol(\"Symbol.asyncIterator\"))) : \"@@asyncIterator\";\n\n// Asynchronously iterate on a value using it's async iterator if present, or its synchronous iterator if missing\nexport function _forAwaitOf(target, body, check) {\n\tif (typeof target[_asyncIteratorSymbol] === \"function\") {\n\t\tvar pact = new _Pact();\n\t\tvar iterator = target[_asyncIteratorSymbol]();\n\t\titerator.next().then(_resumeAfterNext).then(void 0, _reject);\n\t\treturn pact;\n\t\tfunction _resumeAfterBody(result) {\n\t\t\tif (check && check()) {\n\t\t\t\treturn _settle(pact, 1, iterator.return ? iterator.return().then(function() { return result; }) : result);\n\t\t\t}\n\t\t\titerator.next().then(_resumeAfterNext).then(void 0, _reject);\n\t\t}\n\t\tfunction _resumeAfterNext(step) {\n\t\t\tif (step.done) {\n\t\t\t\t_settle(pact, 1);\n\t\t\t} else {\n\t\t\t\tPromise.resolve(body(step.value)).then(_resumeAfterBody).then(void 0, _reject);\n\t\t\t}\n\t\t}\n\t\tfunction _reject(error) {\n\t\t\t_settle(pact, 2, iterator.return ? iterator.return().then(function() { return error; }) : error);\n\t\t}\n\t}\n\treturn Promise.resolve(_forOf(target, function(value) { return Promise.resolve(value).then(body); }, check));\n}\n\n// Asynchronously implement a generic for loop\nexport function _for(test, update, body) {\n\tvar stage;\n\tfor (;;) {\n\t\tvar shouldContinue = test();\n\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\tshouldContinue = shouldContinue.v;\n\t\t}\n\t\tif (!shouldContinue) {\n\t\t\treturn result;\n\t\t}\n\t\tif (shouldContinue.then) {\n\t\t\tstage = 0;\n\t\t\tbreak;\n\t\t}\n\t\tvar result = body();\n\t\tif (result && result.then) {\n\t\t\tif (_isSettledPact(result)) {\n\t\t\t\tresult = result.s;\n\t\t\t} else {\n\t\t\t\tstage = 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (update) {\n\t\t\tvar updateValue = update();\n\t\t\tif (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n\t\t\t\tstage = 2;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tvar pact = new _Pact();\n\tvar reject = _settle.bind(null, pact, 2);\n\t(stage === 0 ? shouldContinue.then(_resumeAfterTest) : stage === 1 ? result.then(_resumeAfterBody) : updateValue.then(_resumeAfterUpdate)).then(void 0, reject);\n\treturn pact;\n\tfunction _resumeAfterBody(value) {\n\t\tresult = value;\n\t\tdo {\n\t\t\tif (update) {\n\t\t\t\tupdateValue = update();\n\t\t\t\tif (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n\t\t\t\t\tupdateValue.then(_resumeAfterUpdate).then(void 0, reject);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tshouldContinue = test();\n\t\t\tif (!shouldContinue || (_isSettledPact(shouldContinue) && !shouldContinue.v)) {\n\t\t\t\t_settle(pact, 1, result);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (shouldContinue.then) {\n\t\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tresult = body();\n\t\t\tif (_isSettledPact(result)) {\n\t\t\t\tresult = result.v;\n\t\t\t}\n\t\t} while (!result || !result.then);\n\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t}\n\tfunction _resumeAfterTest(shouldContinue) {\n\t\tif (shouldContinue) {\n\t\t\tresult = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t} else {\n\t\t\t\t_resumeAfterBody(result);\n\t\t\t}\n\t\t} else {\n\t\t\t_settle(pact, 1, result);\n\t\t}\n\t}\n\tfunction _resumeAfterUpdate() {\n\t\tif (shouldContinue = test()) {\n\t\t\tif (shouldContinue.then) {\n\t\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t} else {\n\t\t\t\t_resumeAfterTest(shouldContinue);\n\t\t\t}\n\t\t} else {\n\t\t\t_settle(pact, 1, result);\n\t\t}\n\t}\n}\n\n// Asynchronously implement a do ... while loop\nexport function _do(body, test) {\n\tvar awaitBody;\n\tdo {\n\t\tvar result = body();\n\t\tif (result && result.then) {\n\t\t\tif (_isSettledPact(result)) {\n\t\t\t\tresult = result.v;\n\t\t\t} else {\n\t\t\t\tawaitBody = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tvar shouldContinue = test();\n\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\tshouldContinue = shouldContinue.v;\n\t\t}\n\t\tif (!shouldContinue) {\n\t\t\treturn result;\n\t\t}\n\t} while (!shouldContinue.then);\n\tconst pact = new _Pact();\n\tconst reject = _settle.bind(null, pact, 2);\n\t(awaitBody ? result.then(_resumeAfterBody) : shouldContinue.then(_resumeAfterTest)).then(void 0, reject);\n\treturn pact;\n\tfunction _resumeAfterBody(value) {\n\t\tresult = value;\n\t\tfor (;;) {\n\t\t\tshouldContinue = test();\n\t\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\t\tshouldContinue = shouldContinue.v;\n\t\t\t}\n\t\t\tif (!shouldContinue) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (shouldContinue.then) {\n\t\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tresult = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\tresult = result.v;\n\t\t\t\t} else {\n\t\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t_settle(pact, 1, result);\n\t}\n\tfunction _resumeAfterTest(shouldContinue) {\n\t\tif (shouldContinue) {\n\t\t\tdo {\n\t\t\t\tresult = body();\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\t\tresult = result.v;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tshouldContinue = test();\n\t\t\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\t\t\tshouldContinue = shouldContinue.v;\n\t\t\t\t}\n\t\t\t\tif (!shouldContinue) {\n\t\t\t\t\t_settle(pact, 1, result);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} while (!shouldContinue.then);\n\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t} else {\n\t\t\t_settle(pact, 1, result);\n\t\t}\n\t}\n}\n\n// Asynchronously implement a switch statement\nexport function _switch(discriminant, cases) {\n\tvar dispatchIndex = -1;\n\tvar awaitBody;\n\touter: {\n\t\tfor (var i = 0; i < cases.length; i++) {\n\t\t\tvar test = cases[i][0];\n\t\t\tif (test) {\n\t\t\t\tvar testValue = test();\n\t\t\t\tif (testValue && testValue.then) {\n\t\t\t\t\tbreak outer;\n\t\t\t\t}\n\t\t\t\tif (testValue === discriminant) {\n\t\t\t\t\tdispatchIndex = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Found the default case, set it as the pending dispatch case\n\t\t\t\tdispatchIndex = i;\n\t\t\t}\n\t\t}\n\t\tif (dispatchIndex !== -1) {\n\t\t\tdo {\n\t\t\t\tvar body = cases[dispatchIndex][1];\n\t\t\t\twhile (!body) {\n\t\t\t\t\tdispatchIndex++;\n\t\t\t\t\tbody = cases[dispatchIndex][1];\n\t\t\t\t}\n\t\t\t\tvar result = body();\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tawaitBody = true;\n\t\t\t\t\tbreak outer;\n\t\t\t\t}\n\t\t\t\tvar fallthroughCheck = cases[dispatchIndex][2];\n\t\t\t\tdispatchIndex++;\n\t\t\t} while (fallthroughCheck && !fallthroughCheck());\n\t\t\treturn result;\n\t\t}\n\t}\n\tconst pact = new _Pact();\n\tconst reject = _settle.bind(null, pact, 2);\n\t(awaitBody ? result.then(_resumeAfterBody) : testValue.then(_resumeAfterTest)).then(void 0, reject);\n\treturn pact;\n\tfunction _resumeAfterTest(value) {\n\t\tfor (;;) {\n\t\t\tif (value === discriminant) {\n\t\t\t\tdispatchIndex = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (++i === cases.length) {\n\t\t\t\tif (dispatchIndex !== -1) {\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\t_settle(pact, 1, result);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\ttest = cases[i][0];\n\t\t\tif (test) {\n\t\t\t\tvalue = test();\n\t\t\t\tif (value && value.then) {\n\t\t\t\t\tvalue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdispatchIndex = i;\n\t\t\t}\n\t\t}\n\t\tdo {\n\t\t\tvar body = cases[dispatchIndex][1];\n\t\t\twhile (!body) {\n\t\t\t\tdispatchIndex++;\n\t\t\t\tbody = cases[dispatchIndex][1];\n\t\t\t}\n\t\t\tvar result = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar fallthroughCheck = cases[dispatchIndex][2];\n\t\t\tdispatchIndex++;\n\t\t} while (fallthroughCheck && !fallthroughCheck());\n\t\t_settle(pact, 1, result);\n\t}\n\tfunction _resumeAfterBody(result) {\n\t\tfor (;;) {\n\t\t\tvar fallthroughCheck = cases[dispatchIndex][2];\n\t\t\tif (!fallthroughCheck || fallthroughCheck()) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdispatchIndex++;\n\t\t\tvar body = cases[dispatchIndex][1];\n\t\t\twhile (!body) {\n\t\t\t\tdispatchIndex++;\n\t\t\t\tbody = cases[dispatchIndex][1];\n\t\t\t}\n\t\t\tresult = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\t_settle(pact, 1, result);\n\t}\n}\n\n// Asynchronously call a function and pass the result to explicitly passed continuations\nexport function _call(body, then, direct) {\n\tif (direct) {\n\t\treturn then ? then(body()) : body();\n\t}\n\ttry {\n\t\tvar result = Promise.resolve(body());\n\t\treturn then ? result.then(then) : result;\n\t} catch (e) {\n\t\treturn Promise.reject(e);\n\t}\n}\n\n// Asynchronously call a function and swallow the result\nexport function _callIgnored(body, direct) {\n\treturn _call(body, _empty, direct);\n}\n\n// Asynchronously call a function and pass the result to explicitly passed continuations\nexport function _invoke(body, then) {\n\tvar result = body();\n\tif (result && result.then) {\n\t\treturn result.then(then);\n\t}\n\treturn then(result);\n}\n\n// Asynchronously call a function and swallow the result\nexport function _invokeIgnored(body) {\n\tvar result = body();\n\tif (result && result.then) {\n\t\treturn result.then(_empty);\n\t}\n}\n\n// Asynchronously call a function and send errors to recovery continuation\nexport function _catch(body, recover) {\n\ttry {\n\t\tvar result = body();\n\t} catch(e) {\n\t\treturn recover(e);\n\t}\n\tif (result && result.then) {\n\t\treturn result.then(void 0, recover);\n\t}\n\treturn result;\n}\n\n// Asynchronously await a promise and pass the result to a finally continuation\nexport function _finallyRethrows(body, finalizer) {\n\ttry {\n\t\tvar result = body();\n\t} catch (e) {\n\t\treturn finalizer(true, e);\n\t}\n\tif (result && result.then) {\n\t\treturn result.then(finalizer.bind(null, false), finalizer.bind(null, true));\n\t}\n\treturn finalizer(false, result);\n}\n\n// Asynchronously await a promise and invoke a finally continuation that always overrides the result\nexport function _finally(body, finalizer) {\n\ttry {\n\t\tvar result = body();\n\t} catch (e) {\n\t\treturn finalizer();\n\t}\n\tif (result && result.then) {\n\t\treturn result.then(finalizer, finalizer);\n\t}\n\treturn finalizer();\n}\n\n// Rethrow or return a value from a finally continuation\nexport function _rethrow(thrown, value) {\n\tif (thrown)\n\t\tthrow value;\n\treturn value;\n}\n\n// Empty function to implement break and other control flow that ignores asynchronous results\nexport function _empty() {\n}\n\n// Sentinel value for early returns in generators \nexport const _earlyReturn = /*#__PURE__*/ {};\n\n// Asynchronously call a function and send errors to recovery continuation, skipping early returns\nexport function _catchInGenerator(body, recover) {\n\treturn _catch(body, function(e) {\n\t\tif (e === _earlyReturn) {\n\t\t\tthrow e;\n\t\t}\n\t\treturn recover(e);\n\t});\n}\n\n// Asynchronous generator class; accepts the entrypoint of the generator, to which it passes itself when the generator should start\nexport const _AsyncGenerator = /*#__PURE__*/(function() {\n\tfunction _AsyncGenerator(entry) {\n\t\tthis._entry = entry;\n\t\tthis._pact = null;\n\t\tthis._resolve = null;\n\t\tthis._return = null;\n\t\tthis._promise = null;\n\t}\n\n\tfunction _wrapReturnedValue(value) {\n\t\treturn { value: value, done: true };\n\t}\n\tfunction _wrapYieldedValue(value) {\n\t\treturn { value: value, done: false };\n\t}\n\n\t_AsyncGenerator.prototype._yield = function(value) {\n\t\t// Yield the value to the pending next call\n\t\tthis._resolve(value && value.then ? value.then(_wrapYieldedValue) : _wrapYieldedValue(value));\n\t\t// Return a pact for an upcoming next/return/throw call\n\t\treturn this._pact = new _Pact();\n\t};\n\t_AsyncGenerator.prototype.next = function(value) {\n\t\t// Advance the generator, starting it if it has yet to be started\n\t\tconst _this = this;\n\t\treturn _this._promise = new Promise(function (resolve) {\n\t\t\tconst _pact = _this._pact;\n\t\t\tif (_pact === null) {\n\t\t\t\tconst _entry = _this._entry;\n\t\t\t\tif (_entry === null) {\n\t\t\t\t\t// Generator is started, but not awaiting a yield expression\n\t\t\t\t\t// Abandon the next call!\n\t\t\t\t\treturn resolve(_this._promise);\n\t\t\t\t}\n\t\t\t\t// Start the generator\n\t\t\t\t_this._entry = null;\n\t\t\t\t_this._resolve = resolve;\n\t\t\t\tfunction returnValue(value) {\n\t\t\t\t\t_this._resolve(value && value.then ? value.then(_wrapReturnedValue) : _wrapReturnedValue(value));\n\t\t\t\t\t_this._pact = null;\n\t\t\t\t\t_this._resolve = null;\n\t\t\t\t}\n\t\t\t\tvar result = _entry(_this);\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tresult.then(returnValue, function(error) {\n\t\t\t\t\t\tif (error === _earlyReturn) {\n\t\t\t\t\t\t\treturnValue(_this._return);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst pact = new _Pact();\n\t\t\t\t\t\t\t_this._resolve(pact);\n\t\t\t\t\t\t\t_this._pact = null;\n\t\t\t\t\t\t\t_this._resolve = null;\n\t\t\t\t\t\t\t_resolve(pact, 2, error);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturnValue(result);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Generator is started and a yield expression is pending, settle it\n\t\t\t\t_this._pact = null;\n\t\t\t\t_this._resolve = resolve;\n\t\t\t\t_settle(_pact, 1, value);\n\t\t\t}\n\t\t});\n\t};\n\t_AsyncGenerator.prototype.return = function(value) {\n\t\t// Early return from the generator if started, otherwise abandons the generator\n\t\tconst _this = this;\n\t\treturn _this._promise = new Promise(function (resolve) {\n\t\t\tconst _pact = _this._pact;\n\t\t\tif (_pact === null) {\n\t\t\t\tif (_this._entry === null) {\n\t\t\t\t\t// Generator is started, but not awaiting a yield expression\n\t\t\t\t\t// Abandon the return call!\n\t\t\t\t\treturn resolve(_this._promise);\n\t\t\t\t}\n\t\t\t\t// Generator is not started, abandon it and return the specified value\n\t\t\t\t_this._entry = null;\n\t\t\t\treturn resolve(value && value.then ? value.then(_wrapReturnedValue) : _wrapReturnedValue(value));\n\t\t\t}\n\t\t\t// Settle the yield expression with a rejected \"early return\" value\n\t\t\t_this._return = value;\n\t\t\t_this._resolve = resolve;\n\t\t\t_this._pact = null;\n\t\t\t_settle(_pact, 2, _earlyReturn);\n\t\t});\n\t};\n\t_AsyncGenerator.prototype.throw = function(error) {\n\t\t// Inject an exception into the pending yield expression\n\t\tconst _this = this;\n\t\treturn _this._promise = new Promise(function (resolve, reject) {\n\t\t\tconst _pact = _this._pact;\n\t\t\tif (_pact === null) {\n\t\t\t\tif (_this._entry === null) {\n\t\t\t\t\t// Generator is started, but not awaiting a yield expression\n\t\t\t\t\t// Abandon the throw call!\n\t\t\t\t\treturn resolve(_this._promise);\n\t\t\t\t}\n\t\t\t\t// Generator is not started, abandon it and return a rejected Promise containing the error\n\t\t\t\t_this._entry = null;\n\t\t\t\treturn reject(error);\n\t\t\t}\n\t\t\t// Settle the yield expression with the value as a rejection\n\t\t\t_this._resolve = resolve;\n\t\t\t_this._pact = null;\n\t\t\t_settle(_pact, 2, error);\n\t\t});\n\t};\n\n\t_AsyncGenerator.prototype[_asyncIteratorSymbol] = function() {\n\t\treturn this;\n\t};\n\t\n\treturn _AsyncGenerator;\n})();\n","import fs from 'fs';\r\nimport { promisify } from 'es6-promisify';\r\n\r\nexport const readFile = promisify(fs.readFile);\r\n// export const writeFile = promisify(fs.writeFile);\r\nexport const stat = promisify(fs.stat);\r\nexport const isDir = name =>\r\n\tstat(name)\r\n\t\t.then(stats => stats.isDirectory())\r\n\t\t.catch(() => false);\r\nexport const isFile = name =>\r\n\tstat(name)\r\n\t\t.then(stats => stats.isFile())\r\n\t\t.catch(() => false);\r\nexport const stdout = console.log.bind(console); // eslint-disable-line no-console\r\nexport const stderr = console.error.bind(console);\r\n\r\nexport const isTruthy = obj => {\r\n\tif (!obj) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn obj.constructor !== Object || Object.keys(obj).length > 0;\r\n};\r\n","import { createConfigItem } from '@babel/core';\r\nimport babelPlugin from 'rollup-plugin-babel';\r\nimport merge from 'lodash.merge';\r\nimport { isTruthy } from '../utils';\r\n\r\nconst ESMODULES_TARGET = {\r\n\tesmodules: true,\r\n};\r\n\r\nconst mergeConfigItems = (type, ...configItemsToMerge) => {\r\n\tconst mergedItems = [];\r\n\r\n\tconfigItemsToMerge.forEach(configItemToMerge => {\r\n\t\tconfigItemToMerge.forEach(item => {\r\n\t\t\tconst itemToMergeWithIndex = mergedItems.findIndex(\r\n\t\t\t\tmergedItem => mergedItem.file.resolved === item.file.resolved,\r\n\t\t\t);\r\n\r\n\t\t\tif (itemToMergeWithIndex === -1) {\r\n\t\t\t\tmergedItems.push(item);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tmergedItems[itemToMergeWithIndex] = createConfigItem(\r\n\t\t\t\t[\r\n\t\t\t\t\tmergedItems[itemToMergeWithIndex].file.resolved,\r\n\t\t\t\t\tmerge(mergedItems[itemToMergeWithIndex].options, item.options),\r\n\t\t\t\t],\r\n\t\t\t\t{\r\n\t\t\t\t\ttype,\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t});\r\n\t});\r\n\r\n\treturn mergedItems;\r\n};\r\n\r\nconst createConfigItems = (type, items) => {\r\n\treturn items.map(({ name, ...options }) => {\r\n\t\treturn createConfigItem([require.resolve(name), options], { type });\r\n\t});\r\n};\r\n\r\nconst presetEnvRegex = RegExp(/@babel\\/(preset-)?env/);\r\n\r\nexport default () => {\r\n\treturn babelPlugin.custom(babelCore => {\r\n\t\treturn {\r\n\t\t\t// Passed the plugin options.\r\n\t\t\toptions({ custom: customOptions, ...pluginOptions }) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t// Pull out any custom options that the plugin might have.\r\n\t\t\t\t\tcustomOptions,\r\n\r\n\t\t\t\t\t// Pass the options back with the two custom options removed.\r\n\t\t\t\t\tpluginOptions,\r\n\t\t\t\t};\r\n\t\t\t},\r\n\r\n\t\t\tconfig(config, { customOptions }) {\r\n\t\t\t\tconst defaultPlugins = createConfigItems(\r\n\t\t\t\t\t'plugin',\r\n\t\t\t\t\t[\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: '@babel/plugin-transform-react-jsx',\r\n\t\t\t\t\t\t\tpragma: customOptions.pragma || 'h',\r\n\t\t\t\t\t\t\tpragmaFrag: customOptions.pragmaFrag || 'Fragment',\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t!customOptions.typescript && {\r\n\t\t\t\t\t\t\tname: '@babel/plugin-transform-flow-strip-types',\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tisTruthy(customOptions.defines) && {\r\n\t\t\t\t\t\t\tname: 'babel-plugin-transform-replace-expressions',\r\n\t\t\t\t\t\t\treplace: customOptions.defines,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t!customOptions.modern && {\r\n\t\t\t\t\t\t\tname: 'babel-plugin-transform-async-to-promises',\r\n\t\t\t\t\t\t\tinlineHelpers: true,\r\n\t\t\t\t\t\t\texternalHelpers: true,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: '@babel/plugin-proposal-decorators',\r\n\t\t\t\t\t\t\tlegacy: true,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: '@babel/plugin-proposal-optional-chaining',\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: '@babel/plugin-proposal-class-properties',\r\n\t\t\t\t\t\t\tloose: true,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t!customOptions.modern && {\r\n\t\t\t\t\t\t\tname: '@babel/plugin-transform-regenerator',\r\n\t\t\t\t\t\t\tasync: false,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: 'babel-plugin-macros',\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t].filter(Boolean),\r\n\t\t\t\t);\r\n\r\n\t\t\t\tconst babelOptions = config.options || {};\r\n\r\n\t\t\t\tconst envIdx = (babelOptions.presets || []).findIndex(preset =>\r\n\t\t\t\t\tpresetEnvRegex.test(preset.file.request),\r\n\t\t\t\t);\r\n\r\n\t\t\t\tconst environmentPreset = customOptions.modern\r\n\t\t\t\t\t? '@babel/preset-modules'\r\n\t\t\t\t\t: '@babel/preset-env';\r\n\r\n\t\t\t\tif (envIdx !== -1) {\r\n\t\t\t\t\tconst preset = babelOptions.presets[envIdx];\r\n\t\t\t\t\tbabelOptions.presets[envIdx] = createConfigItem(\r\n\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\tenvironmentPreset,\r\n\t\t\t\t\t\t\tObject.assign(\r\n\t\t\t\t\t\t\t\tmerge(\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tloose: true,\r\n\t\t\t\t\t\t\t\t\t\tuseBuiltIns: false,\r\n\t\t\t\t\t\t\t\t\t\ttargets: customOptions.targets,\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tpreset.options,\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tmodules: false,\r\n\t\t\t\t\t\t\t\t\t\texclude: merge(\r\n\t\t\t\t\t\t\t\t\t\t\t['transform-async-to-generator', 'transform-regenerator'],\r\n\t\t\t\t\t\t\t\t\t\t\t(preset.options && preset.options.exclude) || [],\r\n\t\t\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\tcustomOptions.modern ? { targets: ESMODULES_TARGET } : {},\r\n\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttype: `preset`,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbabelOptions.presets = createConfigItems('preset', [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: environmentPreset,\r\n\t\t\t\t\t\t\ttargets: customOptions.modern\r\n\t\t\t\t\t\t\t\t? ESMODULES_TARGET\r\n\t\t\t\t\t\t\t\t: customOptions.targets,\r\n\t\t\t\t\t\t\tmodules: false,\r\n\t\t\t\t\t\t\tloose: true,\r\n\t\t\t\t\t\t\tuseBuiltIns: false,\r\n\t\t\t\t\t\t\texclude: [\r\n\t\t\t\t\t\t\t\t'transform-async-to-generator',\r\n\t\t\t\t\t\t\t\t'transform-regenerator',\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Merge babelrc & our plugins together\r\n\t\t\t\tbabelOptions.plugins = mergeConfigItems(\r\n\t\t\t\t\t'plugin',\r\n\t\t\t\t\tdefaultPlugins,\r\n\t\t\t\t\tbabelOptions.plugins || [],\r\n\t\t\t\t);\r\n\r\n\t\t\t\tbabelOptions.generatorOpts = {\r\n\t\t\t\t\tminified: customOptions.compress,\r\n\t\t\t\t\tcompact: customOptions.compress,\r\n\t\t\t\t\tshouldPrintComment: comment => /[@#]__PURE__/.test(comment),\r\n\t\t\t\t};\r\n\r\n\t\t\t\treturn babelOptions;\r\n\t\t\t},\r\n\t\t};\r\n\t});\r\n};\r\n","import { red, dim } from 'kleur';\r\nimport { stderr } from './utils';\r\n\r\nexport default function(err) {\r\n\tconst error = err.error || err;\r\n\tconst description = `${error.name ? error.name + ': ' : ''}${error.message ||\r\n\t\terror}`;\r\n\tconst message = error.plugin\r\n\t\t? `(${error.plugin} plugin) ${description}`\r\n\t\t: description;\r\n\r\n\tstderr(red().bold(message));\r\n\r\n\tif (error.loc) {\r\n\t\tstderr();\r\n\t\tstderr(`at ${error.loc.file}:${error.loc.line}:${error.loc.column}`);\r\n\t}\r\n\r\n\tif (error.frame) {\r\n\t\tstderr();\r\n\t\tstderr(dim(error.frame));\r\n\t} else if (err.stack) {\r\n\t\tconst headlessStack = error.stack.replace(message, '');\r\n\t\tstderr(dim(headlessStack));\r\n\t}\r\n\r\n\tstderr();\r\n}\r\n","import fs from 'fs';\r\nimport { resolve, relative, dirname, basename, extname } from 'path';\r\nimport { green, red, yellow, white, blue } from 'kleur';\r\nimport { map, series } from 'asyncro';\r\nimport glob from 'tiny-glob/sync';\r\nimport autoprefixer from 'autoprefixer';\r\nimport cssnano from 'cssnano';\r\nimport { rollup, watch } from 'rollup';\r\nimport commonjs from '@rollup/plugin-commonjs';\r\nimport babel from 'rollup-plugin-babel';\r\nimport customBabel from './lib/babel-custom';\r\nimport nodeResolve from '@rollup/plugin-node-resolve';\r\nimport { terser } from 'rollup-plugin-terser';\r\nimport alias from '@rollup/plugin-alias';\r\nimport postcss from 'rollup-plugin-postcss';\r\nimport postcssCopy from 'postcss-copy';\r\nimport gzipSize from 'gzip-size';\r\nimport brotliSize from 'brotli-size';\r\nimport prettyBytes from 'pretty-bytes';\r\nimport typescript from 'rollup-plugin-typescript2';\r\nimport json from '@rollup/plugin-json';\r\nimport svgr from '@svgr/rollup';\r\nimport smartAsset from 'rollup-plugin-smart-asset';\r\nimport logError from './log-error';\r\nimport { readFile, isDir, isFile, stdout, stderr, isTruthy } from './utils';\r\nimport camelCase from 'camelcase';\r\n\r\nconst removeScope = name => name.replace(/^@.*\\//, '');\r\n\r\n// Convert booleans and int define= values to literals.\r\n// This is more intuitive than `microbundle --define A=1` producing A=\"1\".\r\nconst toReplacementExpression = (value, name) => {\r\n\t// --define A=\"1\",B='true' produces string:\r\n\tconst matches = value.match(/^(['\"])(.+)\\1$/);\r\n\tif (matches) {\r\n\t\treturn [JSON.stringify(matches[2]), name];\r\n\t}\r\n\r\n\t// --define A=1,B=true produces int/boolean literal:\r\n\tif (/^(true|false|\\d+)$/i.test(value)) {\r\n\t\treturn [value, name];\r\n\t}\r\n\r\n\t// default: string literal\r\n\treturn [JSON.stringify(value), name];\r\n};\r\n\r\n// Normalize Terser options from microbundle's relaxed JSON format (mutates argument in-place)\r\nfunction normalizeMinifyOptions(minifyOptions) {\r\n\tconst mangle = minifyOptions.mangle || (minifyOptions.mangle = {});\r\n\tlet properties = mangle.properties;\r\n\r\n\t// allow top-level \"properties\" key to override mangle.properties (including {properties:false}):\r\n\tif (minifyOptions.properties != null) {\r\n\t\tproperties = mangle.properties =\r\n\t\t\tminifyOptions.properties &&\r\n\t\t\tObject.assign(properties, minifyOptions.properties);\r\n\t}\r\n\r\n\t// allow previous format ({ mangle:{regex:'^_',reserved:[]} }):\r\n\tif (minifyOptions.regex || minifyOptions.reserved) {\r\n\t\tif (!properties) properties = mangle.properties = {};\r\n\t\tproperties.regex = properties.regex || minifyOptions.regex;\r\n\t\tproperties.reserved = properties.reserved || minifyOptions.reserved;\r\n\t}\r\n\r\n\tif (properties) {\r\n\t\tif (properties.regex) properties.regex = new RegExp(properties.regex);\r\n\t\tproperties.reserved = [].concat(properties.reserved || []);\r\n\t}\r\n}\r\n\r\n// Parses values of the form \"$=jQuery,React=react\" into key-value object pairs.\r\nconst parseMappingArgument = (globalStrings, processValue) => {\r\n\tconst globals = {};\r\n\tglobalStrings.split(',').forEach(globalString => {\r\n\t\tlet [key, value] = globalString.split('=');\r\n\t\tif (processValue) {\r\n\t\t\tconst r = processValue(value, key);\r\n\t\t\tif (r !== undefined) {\r\n\t\t\t\tif (Array.isArray(r)) {\r\n\t\t\t\t\t[value, key] = r;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = r;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tglobals[key] = value;\r\n\t});\r\n\treturn globals;\r\n};\r\n\r\n// Parses values of the form \"$=jQuery,React=react\" into key-value object pairs.\r\nconst parseMappingArgumentAlias = aliasStrings => {\r\n\treturn aliasStrings.split(',').map(str => {\r\n\t\tlet [key, value] = str.split('=');\r\n\t\treturn { find: key, replacement: value };\r\n\t});\r\n};\r\n\r\n// Extensions to use when resolving modules\r\nconst EXTENSIONS = [\r\n\t'.ts',\r\n\t'.tsx',\r\n\t'.js',\r\n\t'.jsx',\r\n\t'.es6',\r\n\t'.es',\r\n\t'.mjs',\r\n\t'.jpg',\r\n\t'.png',\r\n\t'.svg',\r\n];\r\n\r\nconst WATCH_OPTS = {\r\n\texclude: 'node_modules/**',\r\n};\r\n\r\n// Hoist function because something (rollup?) incorrectly removes it\r\nfunction formatSize(size, filename, type, raw) {\r\n\tconst pretty = raw ? `${size} B` : prettyBytes(size);\r\n\tconst color = size < 5000 ? green : size > 40000 ? red : yellow;\r\n\tconst MAGIC_INDENTATION = type === 'br' ? 13 : 10;\r\n\treturn `${' '.repeat(MAGIC_INDENTATION - pretty.length)}${color(\r\n\t\tpretty,\r\n\t)}: ${white(basename(filename))}.${type}`;\r\n}\r\n\r\nasync function getSizeInfo(code, filename, raw) {\r\n\tconst gzip = formatSize(\r\n\t\tawait gzipSize(code),\r\n\t\tfilename,\r\n\t\t'gz',\r\n\t\traw || code.length < 5000,\r\n\t);\r\n\tlet brotli;\r\n\t//wrap brotliSize in try/catch in case brotli is unavailable due to\r\n\t//lower node version\r\n\ttry {\r\n\t\tbrotli = formatSize(\r\n\t\t\tawait brotliSize(code),\r\n\t\t\tfilename,\r\n\t\t\t'br',\r\n\t\t\traw || code.length < 5000,\r\n\t\t);\r\n\t} catch (e) {\r\n\t\treturn gzip;\r\n\t}\r\n\treturn gzip + '\\n' + brotli;\r\n}\r\n\r\nexport default async function microbundle(inputOptions) {\r\n\tlet options = { ...inputOptions };\r\n\r\n\toptions.cwd = resolve(process.cwd(), inputOptions.cwd);\r\n\tconst cwd = options.cwd;\r\n\r\n\tconst { hasPackageJson, pkg } = await getConfigFromPkgJson(cwd);\r\n\toptions.pkg = pkg;\r\n\r\n\tconst { finalName, pkgName } = getName({\r\n\t\tname: options.name,\r\n\t\tpkgName: options.pkg.name,\r\n\t\tamdName: options.pkg.amdName,\r\n\t\thasPackageJson,\r\n\t\tcwd,\r\n\t});\r\n\r\n\toptions.name = finalName;\r\n\toptions.pkg.name = pkgName;\r\n\r\n\tif (options.sourcemap !== false) {\r\n\t\toptions.sourcemap = true;\r\n\t}\r\n\r\n\toptions.input = await getInput({\r\n\t\tentries: options.entries,\r\n\t\tcwd,\r\n\t\tsource: options.pkg.source,\r\n\t\tmodule: options.pkg.module,\r\n\t});\r\n\r\n\toptions.output = await getOutput({\r\n\t\tcwd,\r\n\t\toutput: options.output,\r\n\t\tpkgMain: options.pkg.main,\r\n\t\tpkgName: options.pkg.name,\r\n\t});\r\n\r\n\toptions.entries = await getEntries({\r\n\t\tcwd,\r\n\t\tinput: options.input,\r\n\t});\r\n\r\n\toptions.multipleEntries = options.entries.length > 1;\r\n\r\n\t// to disable compress you can put in false or 0 but it's a string so our boolean checks won't work\r\n\toptions.compress =\r\n\t\ttypeof options.compress !== 'boolean'\r\n\t\t\t? options.compress !== 'false' && options.compress !== '0'\r\n\t\t\t: options.compress;\r\n\r\n\tlet formats = (options.format || options.formats).split(',');\r\n\t// always compile cjs first if it's there:\r\n\tformats.sort((a, b) => (a === 'cjs' ? -1 : a > b ? 1 : 0));\r\n\r\n\tlet steps = [];\r\n\tfor (let i = 0; i < options.entries.length; i++) {\r\n\t\tfor (let j = 0; j < formats.length; j++) {\r\n\t\t\tsteps.push(\r\n\t\t\t\tcreateConfig(\r\n\t\t\t\t\toptions,\r\n\t\t\t\t\toptions.entries[i],\r\n\t\t\t\t\tformats[j],\r\n\t\t\t\t\ti === 0 && j === 0,\r\n\t\t\t\t),\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tif (options.watch) {\r\n\t\tconst onBuild = options.onBuild;\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tstdout(\r\n\t\t\t\tblue(\r\n\t\t\t\t\t`Watching source, compiling to ${relative(\r\n\t\t\t\t\t\tcwd,\r\n\t\t\t\t\t\tdirname(options.output),\r\n\t\t\t\t\t)}:`,\r\n\t\t\t\t),\r\n\t\t\t);\r\n\t\t\tsteps.map(options => {\r\n\t\t\t\twatch(\r\n\t\t\t\t\tObject.assign(\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\toutput: options.outputOptions,\r\n\t\t\t\t\t\t\twatch: WATCH_OPTS,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\toptions.inputOptions,\r\n\t\t\t\t\t),\r\n\t\t\t\t).on('event', e => {\r\n\t\t\t\t\tif (e.code === 'FATAL') {\r\n\t\t\t\t\t\treturn reject(e.error);\r\n\t\t\t\t\t} else if (e.code === 'ERROR') {\r\n\t\t\t\t\t\tlogError(e.error);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (e.code === 'END') {\r\n\t\t\t\t\t\toptions._sizeInfo.then(text => {\r\n\t\t\t\t\t\t\tstdout(`Wrote ${text.trim()}`);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif (typeof onBuild === 'function') {\r\n\t\t\t\t\t\t\tonBuild(e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tlet cache;\r\n\tlet out = await series(\r\n\t\tsteps.map(config => async () => {\r\n\t\t\tconst { inputOptions, outputOptions } = config;\r\n\t\t\tinputOptions.cache = cache;\r\n\t\t\tlet bundle = await rollup(inputOptions);\r\n\t\t\tcache = bundle;\r\n\t\t\tawait bundle.write(outputOptions);\r\n\t\t\treturn await config._sizeInfo;\r\n\t\t}),\r\n\t);\r\n\r\n\treturn (\r\n\t\tblue(\r\n\t\t\t`Build \"${options.name}\" to ${relative(cwd, dirname(options.output)) ||\r\n\t\t\t\t'.'}:`,\r\n\t\t) +\r\n\t\t'\\n   ' +\r\n\t\tout.join('\\n   ')\r\n\t);\r\n}\r\n\r\nasync function getConfigFromPkgJson(cwd) {\r\n\ttry {\r\n\t\tconst pkgJSON = await readFile(resolve(cwd, 'package.json'), 'utf8');\r\n\t\tconst pkg = JSON.parse(pkgJSON);\r\n\r\n\t\treturn {\r\n\t\t\thasPackageJson: true,\r\n\t\t\tpkg,\r\n\t\t};\r\n\t} catch (err) {\r\n\t\tconst pkgName = basename(cwd);\r\n\r\n\t\tstderr(\r\n\t\t\t// `Warn ${yellow(`no package.json found. Assuming a pkg.name of \"${pkgName}\".`)}`\r\n\t\t\tyellow(\r\n\t\t\t\t`${yellow().inverse(\r\n\t\t\t\t\t'WARN',\r\n\t\t\t\t)} no package.json found. Assuming a pkg.name of \"${pkgName}\".`,\r\n\t\t\t),\r\n\t\t);\r\n\r\n\t\tlet msg = String(err.message || err);\r\n\t\tif (!msg.match(/ENOENT/)) stderr(`  ${red().dim(msg)}`);\r\n\r\n\t\treturn { hasPackageJson: false, pkg: { name: pkgName } };\r\n\t}\r\n}\r\n\r\nconst safeVariableName = name =>\r\n\tcamelCase(\r\n\t\tremoveScope(name)\r\n\t\t\t.toLowerCase()\r\n\t\t\t.replace(/((^[^a-zA-Z]+)|[^\\w.-])|([^a-zA-Z0-9]+$)/g, ''),\r\n\t);\r\n\r\nfunction getName({ name, pkgName, amdName, cwd, hasPackageJson }) {\r\n\tif (!pkgName) {\r\n\t\tpkgName = basename(cwd);\r\n\t\tif (hasPackageJson) {\r\n\t\t\tstderr(\r\n\t\t\t\tyellow(\r\n\t\t\t\t\t`${yellow().inverse(\r\n\t\t\t\t\t\t'WARN',\r\n\t\t\t\t\t)} missing package.json \"name\" field. Assuming \"${pkgName}\".`,\r\n\t\t\t\t),\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\treturn { finalName: name || amdName || safeVariableName(pkgName), pkgName };\r\n}\r\n\r\nasync function jsOrTs(cwd, filename) {\r\n\tconst extension = (await isFile(resolve(cwd, filename + '.ts')))\r\n\t\t? '.ts'\r\n\t\t: (await isFile(resolve(cwd, filename + '.tsx')))\r\n\t\t? '.tsx'\r\n\t\t: '.js';\r\n\r\n\treturn resolve(cwd, `${filename}${extension}`);\r\n}\r\n\r\nasync function getInput({ entries, cwd, source, module }) {\r\n\tconst input = [];\r\n\r\n\t[]\r\n\t\t.concat(\r\n\t\t\tentries && entries.length\r\n\t\t\t\t? entries\r\n\t\t\t\t: (source &&\r\n\t\t\t\t\t\t(Array.isArray(source) ? source : [source]).map(file =>\r\n\t\t\t\t\t\t\tresolve(cwd, file),\r\n\t\t\t\t\t\t)) ||\r\n\t\t\t\t\t\t((await isDir(resolve(cwd, 'src'))) &&\r\n\t\t\t\t\t\t\t(await jsOrTs(cwd, 'src/index'))) ||\r\n\t\t\t\t\t\t(await jsOrTs(cwd, 'index')) ||\r\n\t\t\t\t\t\tmodule,\r\n\t\t)\r\n\t\t.map(file => glob(file))\r\n\t\t.forEach(file => input.push(...file));\r\n\r\n\treturn input;\r\n}\r\n\r\nasync function getOutput({ cwd, output, pkgMain, pkgName }) {\r\n\tlet main = resolve(cwd, output || pkgMain || 'dist');\r\n\tif (!main.match(/\\.[a-z]+$/) || (await isDir(main))) {\r\n\t\tmain = resolve(main, `${removeScope(pkgName)}.js`);\r\n\t}\r\n\treturn main;\r\n}\r\n\r\nasync function getEntries({ input, cwd }) {\r\n\tlet entries = (\r\n\t\tawait map([].concat(input), async file => {\r\n\t\t\tfile = resolve(cwd, file);\r\n\t\t\tif (await isDir(file)) {\r\n\t\t\t\tfile = resolve(file, 'index.js');\r\n\t\t\t}\r\n\t\t\treturn file;\r\n\t\t})\r\n\t).filter((item, i, arr) => arr.indexOf(item) === i);\r\n\treturn entries;\r\n}\r\n\r\n// shebang cache map because the transform only gets run once\r\nconst shebang = {};\r\n\r\nfunction createConfig(options, entry, format, writeMeta) {\r\n\tlet { pkg } = options;\r\n\r\n\tlet external = ['dns', 'fs', 'path', 'url'].concat(\r\n\t\toptions.entries.filter(e => e !== entry),\r\n\t);\r\n\r\n\tlet outputAliases = {};\r\n\t// since we transform src/index.js, we need to rename imports for it:\r\n\tif (options.multipleEntries) {\r\n\t\toutputAliases['.'] = './' + basename(options.output);\r\n\t}\r\n\r\n\tconst moduleAliases = options.alias\r\n\t\t? parseMappingArgumentAlias(options.alias)\r\n\t\t: [];\r\n\r\n\tconst peerDeps = Object.keys(pkg.peerDependencies || {});\r\n\tif (options.external === 'none') {\r\n\t\t// bundle everything (external=[])\r\n\t} else if (options.external) {\r\n\t\texternal = external.concat(peerDeps).concat(options.external.split(','));\r\n\t} else {\r\n\t\texternal = external\r\n\t\t\t.concat(peerDeps)\r\n\t\t\t.concat(Object.keys(pkg.dependencies || {}));\r\n\t}\r\n\r\n\tlet globals = external.reduce((globals, name) => {\r\n\t\t// valid JS identifiers are usually library globals:\r\n\t\tif (name.match(/^[a-z_$][a-z0-9_$]*$/)) {\r\n\t\t\tglobals[name] = name;\r\n\t\t}\r\n\t\treturn globals;\r\n\t}, {});\r\n\tif (options.globals && options.globals !== 'none') {\r\n\t\tglobals = Object.assign(globals, parseMappingArgument(options.globals));\r\n\t}\r\n\r\n\tlet defines = {};\r\n\tif (options.define) {\r\n\t\tdefines = Object.assign(\r\n\t\t\tdefines,\r\n\t\t\tparseMappingArgument(options.define, toReplacementExpression),\r\n\t\t);\r\n\t}\r\n\r\n\tfunction replaceName(filename, name) {\r\n\t\treturn resolve(\r\n\t\t\tdirname(filename),\r\n\t\t\tname + basename(filename).replace(/^[^.]+/, ''),\r\n\t\t);\r\n\t}\r\n\r\n\tlet mainNoExtension = options.output;\r\n\tif (options.multipleEntries) {\r\n\t\tlet name = entry.match(/([\\\\/])index(\\.(umd|cjs|es|m))?\\.m?js$/)\r\n\t\t\t? mainNoExtension\r\n\t\t\t: entry;\r\n\t\tmainNoExtension = resolve(dirname(mainNoExtension), basename(name));\r\n\t}\r\n\tmainNoExtension = mainNoExtension.replace(/(\\.(umd|cjs|es|m))?\\.m?js$/, '');\r\n\r\n\tlet moduleMain = replaceName(\r\n\t\tpkg.module && !pkg.module.match(/src\\//)\r\n\t\t\t? pkg.module\r\n\t\t\t: pkg['jsnext:main'] || 'x.esm.js',\r\n\t\tmainNoExtension,\r\n\t);\r\n\tlet modernMain = replaceName(\r\n\t\t(pkg.syntax && pkg.syntax.esmodules) || pkg.esmodule || 'x.modern.js',\r\n\t\tmainNoExtension,\r\n\t);\r\n\tlet cjsMain = replaceName(pkg['cjs:main'] || 'x.js', mainNoExtension);\r\n\tlet umdMain = replaceName(pkg['umd:main'] || 'x.umd.js', mainNoExtension);\r\n\r\n\tconst modern = format === 'modern';\r\n\r\n\t// let rollupName = safeVariableName(basename(entry).replace(/\\.js$/, ''));\r\n\r\n\tlet nameCache = {};\r\n\tconst bareNameCache = nameCache;\r\n\t// Support \"minify\" field and legacy \"mangle\" field via package.json:\r\n\tconst rawMinifyValue = options.pkg.minify || options.pkg.mangle || {};\r\n\tlet minifyOptions = typeof rawMinifyValue === 'string' ? {} : rawMinifyValue;\r\n\tconst getNameCachePath =\r\n\t\ttypeof rawMinifyValue === 'string'\r\n\t\t\t? () => resolve(options.cwd, rawMinifyValue)\r\n\t\t\t: () => resolve(options.cwd, 'mangle.json');\r\n\r\n\tconst useTypescript = extname(entry) === '.ts' || extname(entry) === '.tsx';\r\n\r\n\tconst externalPredicate = new RegExp(`^(${external.join('|')})($|/)`);\r\n\tconst externalTest =\r\n\t\texternal.length === 0 ? id => false : id => externalPredicate.test(id);\r\n\r\n\tfunction loadNameCache() {\r\n\t\ttry {\r\n\t\t\tnameCache = JSON.parse(fs.readFileSync(getNameCachePath(), 'utf8'));\r\n\t\t\t// mangle.json can contain a \"minify\" field, same format as the pkg.mangle:\r\n\t\t\tif (nameCache.minify) {\r\n\t\t\t\tminifyOptions = Object.assign(\r\n\t\t\t\t\t{},\r\n\t\t\t\t\tminifyOptions || {},\r\n\t\t\t\t\tnameCache.minify,\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t} catch (e) {}\r\n\t}\r\n\tloadNameCache();\r\n\r\n\tnormalizeMinifyOptions(minifyOptions);\r\n\r\n\tif (nameCache === bareNameCache) nameCache = null;\r\n\r\n\tlet config = {\r\n\t\tinputOptions: {\r\n\t\t\tinput: entry,\r\n\t\t\texternal: id => {\r\n\t\t\t\tif (id === 'babel-plugin-transform-async-to-promises/helpers') {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tif (options.multipleEntries && id === '.') {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\treturn externalTest(id);\r\n\t\t\t},\r\n\t\t\ttreeshake: {\r\n\t\t\t\tpropertyReadSideEffects: false,\r\n\t\t\t},\r\n\t\t\tplugins: []\r\n\t\t\t\t.concat(\r\n\t\t\t\t\tpostcss({\r\n\t\t\t\t\t\tplugins: [\r\n\t\t\t\t\t\t\tautoprefixer(),\r\n\t\t\t\t\t\t\toptions.compress !== false &&\r\n\t\t\t\t\t\t\t\tcssnano({\r\n\t\t\t\t\t\t\t\t\tpreset: 'default',\r\n\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\tpostcssCopy({\r\n\t\t\t\t\t\t\t\tdest: dirname(options.output),\r\n\t\t\t\t\t\t\t\ttemplate: 'assets/[hash].[ext][query]',\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t].filter(Boolean),\r\n\t\t\t\t\t\tautoModules: shouldCssModules(options),\r\n\t\t\t\t\t\tmodules: cssModulesConfig(options),\r\n\t\t\t\t\t\t// only write out CSS for the first bundle (avoids pointless extra files):\r\n\t\t\t\t\t\tinject: false,\r\n\t\t\t\t\t\textract: !!writeMeta,\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tmoduleAliases.length > 0 &&\r\n\t\t\t\t\t\talias({\r\n\t\t\t\t\t\t\tresolve: EXTENSIONS,\r\n\t\t\t\t\t\t\tentries: moduleAliases,\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\tnodeResolve({\r\n\t\t\t\t\t\tmainFields: ['module', 'jsnext', 'main'],\r\n\t\t\t\t\t\tbrowser: options.target !== 'node',\r\n\t\t\t\t\t\t// defaults + .jsx\r\n\t\t\t\t\t\textensions: ['.mjs', '.js', '.jsx', '.json', '.node'],\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tcommonjs({\r\n\t\t\t\t\t\t// use a regex to make sure to include eventual hoisted packages\r\n\t\t\t\t\t\tinclude: /\\/node_modules\\//,\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tjson(),\r\n\t\t\t\t\tsmartAsset({\r\n\t\t\t\t\t\turl: 'copy',\r\n\t\t\t\t\t\tuseHash: true,\r\n\t\t\t\t\t\tkeepName: true,\r\n\t\t\t\t\t\tkeepImport: true,\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tsvgr(),\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// We have to remove shebang so it doesn't end up in the middle of the code somewhere\r\n\t\t\t\t\t\ttransform: code => ({\r\n\t\t\t\t\t\t\tcode: code.replace(/^#![^\\n]*/, bang => {\r\n\t\t\t\t\t\t\t\tshebang[options.name] = bang;\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\tmap: null,\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t},\r\n\t\t\t\t\tuseTypescript &&\r\n\t\t\t\t\t\ttypescript({\r\n\t\t\t\t\t\t\ttypescript: require('typescript'),\r\n\t\t\t\t\t\t\tcacheRoot: `./node_modules/.cache/.rts2_cache_${format}`,\r\n\t\t\t\t\t\t\tobjectHashIgnoreUnknownHack: true,\r\n\t\t\t\t\t\t\ttsconfigDefaults: {\r\n\t\t\t\t\t\t\t\tcompilerOptions: {\r\n\t\t\t\t\t\t\t\t\tsourceMap: options.sourcemap,\r\n\t\t\t\t\t\t\t\t\tdeclaration: true,\r\n\t\t\t\t\t\t\t\t\tjsx: 'react',\r\n\t\t\t\t\t\t\t\t\tjsxFactory: options.jsx || 'React.createElement',\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\ttsconfig: options.tsconfig,\r\n\t\t\t\t\t\t\ttsconfigOverride: {\r\n\t\t\t\t\t\t\t\tcompilerOptions: {\r\n\t\t\t\t\t\t\t\t\ttarget: 'esnext',\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t// if defines is not set, we shouldn't run babel through node_modules\r\n\t\t\t\t\tisTruthy(defines) &&\r\n\t\t\t\t\t\tbabel({\r\n\t\t\t\t\t\t\tbabelrc: false,\r\n\t\t\t\t\t\t\tconfigFile: false,\r\n\t\t\t\t\t\t\tcompact: false,\r\n\t\t\t\t\t\t\tinclude: 'node_modules/**',\r\n\t\t\t\t\t\t\tplugins: [\r\n\t\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t\trequire.resolve('babel-plugin-transform-replace-expressions'),\r\n\t\t\t\t\t\t\t\t\t{ replace: defines },\r\n\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\tcustomBabel()({\r\n\t\t\t\t\t\textensions: EXTENSIONS,\r\n\t\t\t\t\t\texclude: 'node_modules/**',\r\n\t\t\t\t\t\tpassPerPreset: true, // @see https://babeljs.io/docs/en/options#passperpreset\r\n\t\t\t\t\t\tcustom: {\r\n\t\t\t\t\t\t\tdefines,\r\n\t\t\t\t\t\t\tmodern,\r\n\t\t\t\t\t\t\tcompress: options.compress !== false,\r\n\t\t\t\t\t\t\ttargets: options.target === 'node' ? { node: '8' } : undefined,\r\n\t\t\t\t\t\t\tpragma: options.jsx || 'React.createElement',\r\n\t\t\t\t\t\t\tpragmaFrag: options.jsxFragment || 'Fragment',\r\n\t\t\t\t\t\t\ttypescript: !!useTypescript,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t}),\r\n\t\t\t\t\toptions.compress !== false && [\r\n\t\t\t\t\t\tterser({\r\n\t\t\t\t\t\t\tsourcemap: true,\r\n\t\t\t\t\t\t\tcompress: Object.assign(\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tkeep_infinity: true,\r\n\t\t\t\t\t\t\t\t\tpure_getters: true,\r\n\t\t\t\t\t\t\t\t\t// Ideally we'd just get Terser to respect existing Arrow functions...\r\n\t\t\t\t\t\t\t\t\t// unsafe_arrows: true,\r\n\t\t\t\t\t\t\t\t\tpasses: 10,\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tminifyOptions.compress || {},\r\n\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\toutput: {\r\n\t\t\t\t\t\t\t\t// By default, Terser wraps function arguments in extra parens to trigger eager parsing.\r\n\t\t\t\t\t\t\t\t// Whether this is a good idea is way too specific to guess, so we optimize for size by default:\r\n\t\t\t\t\t\t\t\twrap_func_args: false,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\twarnings: true,\r\n\t\t\t\t\t\t\tecma: modern ? 9 : 5,\r\n\t\t\t\t\t\t\ttoplevel: modern || format === 'cjs' || format === 'es',\r\n\t\t\t\t\t\t\tmangle: Object.assign({}, minifyOptions.mangle || {}),\r\n\t\t\t\t\t\t\tnameCache,\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\tnameCache && {\r\n\t\t\t\t\t\t\t// before hook\r\n\t\t\t\t\t\t\toptions: loadNameCache,\r\n\t\t\t\t\t\t\t// after hook\r\n\t\t\t\t\t\t\twriteBundle() {\r\n\t\t\t\t\t\t\t\tif (writeMeta && nameCache) {\r\n\t\t\t\t\t\t\t\t\tfs.writeFile(\r\n\t\t\t\t\t\t\t\t\t\tgetNameCachePath(),\r\n\t\t\t\t\t\t\t\t\t\tJSON.stringify(nameCache, null, 2),\r\n\t\t\t\t\t\t\t\t\t\t() => {},\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t],\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\twriteBundle(bundle) {\r\n\t\t\t\t\t\t\tconfig._sizeInfo = Promise.all(\r\n\t\t\t\t\t\t\t\tObject.values(bundle).map(({ code, fileName }) => {\r\n\t\t\t\t\t\t\t\t\tif (code) {\r\n\t\t\t\t\t\t\t\t\t\treturn getSizeInfo(code, fileName, options.raw);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t).then(results => results.filter(Boolean).join('\\n'));\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t)\r\n\t\t\t\t.filter(Boolean),\r\n\t\t},\r\n\r\n\t\toutputOptions: {\r\n\t\t\tpaths: outputAliases,\r\n\t\t\tglobals,\r\n\t\t\tstrict: options.strict === true,\r\n\t\t\tlegacy: true,\r\n\t\t\tfreeze: false,\r\n\t\t\tesModule: false,\r\n\t\t\tsourcemap: options.sourcemap,\r\n\t\t\tget banner() {\r\n\t\t\t\treturn shebang[options.name];\r\n\t\t\t},\r\n\t\t\tformat: modern ? 'es' : format,\r\n\t\t\tname: options.name,\r\n\t\t\tfile: resolve(\r\n\t\t\t\toptions.cwd,\r\n\t\t\t\t{\r\n\t\t\t\t\tmodern: modernMain,\r\n\t\t\t\t\tes: moduleMain,\r\n\t\t\t\t\tumd: umdMain,\r\n\t\t\t\t}[format] || cjsMain,\r\n\t\t\t),\r\n\t\t},\r\n\t};\r\n\r\n\treturn config;\r\n}\r\n\r\nfunction shouldCssModules(options) {\r\n\tconst passedInOption = processCssmodulesArgument(options);\r\n\r\n\t// We should module when my-file.module.css or my-file.css\r\n\tconst moduleAllCss = passedInOption === true;\r\n\r\n\t// We should module when my-file.module.css\r\n\tconst allowOnlySuffixModule = passedInOption === null;\r\n\r\n\treturn moduleAllCss || allowOnlySuffixModule;\r\n}\r\n\r\nfunction cssModulesConfig(options) {\r\n\tconst passedInOption = processCssmodulesArgument(options);\r\n\tconst isWatchMode = options.watch;\r\n\tconst hasPassedInScopeName = !(\r\n\t\ttypeof passedInOption === 'boolean' || passedInOption === null\r\n\t);\r\n\r\n\tif (shouldCssModules(options) || hasPassedInScopeName) {\r\n\t\tlet generateScopedName = isWatchMode\r\n\t\t\t? '_[name]__[local]__[hash:base64:5]'\r\n\t\t\t: '_[hash:base64:5]';\r\n\r\n\t\tif (hasPassedInScopeName) {\r\n\t\t\tgenerateScopedName = passedInOption; // would be the string from --css-modules \"_[hash]\".\r\n\t\t}\r\n\r\n\t\treturn { generateScopedName };\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\n/*\r\nThis is done becuase if you use the cli default property, you get a primiatve \"null\" or \"false\",\r\nbut when using the cli arguments, you always get back strings. This method aims at correcting those\r\nfor both realms. So that both realms _convert_ into primatives.\r\n*/\r\nfunction processCssmodulesArgument(options) {\r\n\tif (options['css-modules'] === 'true' || options['css-modules'] === true)\r\n\t\treturn true;\r\n\tif (options['css-modules'] === 'false' || options['css-modules'] === false)\r\n\t\treturn false;\r\n\tif (options['css-modules'] === 'null' || options['css-modules'] === null)\r\n\t\treturn null;\r\n\r\n\treturn options['css-modules'];\r\n}\r\n"],"names":["readFile","promisify","fs","stat","isDir","name","then","stats","isDirectory","catch","isFile","stdout","console","log","bind","stderr","error","isTruthy","obj","constructor","Object","keys","length","ESMODULES_TARGET","esmodules","mergeConfigItems","type","configItemsToMerge","mergedItems","forEach","configItemToMerge","item","itemToMergeWithIndex","findIndex","mergedItem","file","resolved","push","createConfigItem","merge","options","createConfigItems","items","map","require","resolve","presetEnvRegex","RegExp","babelPlugin","custom","babelCore","customOptions","pluginOptions","config","defaultPlugins","pragma","pragmaFrag","typescript","defines","replace","modern","inlineHelpers","externalHelpers","legacy","loose","async","filter","Boolean","babelOptions","envIdx","presets","preset","test","request","environmentPreset","assign","useBuiltIns","targets","modules","exclude","plugins","generatorOpts","minified","compress","compact","shouldPrintComment","comment","err","description","message","plugin","red","bold","loc","line","column","frame","dim","stack","headlessStack","getEntries","input","cwd","concat","entries","i","arr","indexOf","getOutput","output","pkgMain","pkgName","main","removeScope","match","getInput","source","module","glob","jsOrTs","Array","isArray","filename","extension","getConfigFromPkgJson","pkgJSON","pkg","JSON","parse","hasPackageJson","basename","yellow","inverse","msg","String","microbundle","inputOptions","process","finalName","getName","amdName","sourcemap","multipleEntries","formats","format","split","sort","a","b","steps","j","createConfig","watch","onBuild","Promise","reject","blue","relative","dirname","outputOptions","WATCH_OPTS","on","e","code","logError","_sizeInfo","text","trim","cache","series","rollup","bundle","write","out","join","getSizeInfo","raw","gzipSize","gzip","brotli","formatSize","brotliSize","toReplacementExpression","value","matches","stringify","normalizeMinifyOptions","minifyOptions","mangle","properties","regex","reserved","parseMappingArgument","globalStrings","processValue","globals","globalString","key","r","undefined","parseMappingArgumentAlias","aliasStrings","str","find","replacement","EXTENSIONS","size","pretty","prettyBytes","color","green","MAGIC_INDENTATION","repeat","white","safeVariableName","camelCase","toLowerCase","shebang","entry","writeMeta","external","outputAliases","moduleAliases","alias","peerDeps","peerDependencies","dependencies","reduce","define","replaceName","mainNoExtension","moduleMain","modernMain","syntax","esmodule","cjsMain","umdMain","nameCache","bareNameCache","rawMinifyValue","minify","getNameCachePath","useTypescript","extname","externalPredicate","externalTest","id","loadNameCache","readFileSync","treeshake","propertyReadSideEffects","postcss","autoprefixer","cssnano","postcssCopy","dest","template","autoModules","shouldCssModules","cssModulesConfig","inject","extract","nodeResolve","mainFields","browser","target","extensions","commonjs","include","json","smartAsset","url","useHash","keepName","keepImport","svgr","transform","bang","cacheRoot","objectHashIgnoreUnknownHack","tsconfigDefaults","compilerOptions","sourceMap","declaration","jsx","jsxFactory","tsconfig","tsconfigOverride","babel","babelrc","configFile","customBabel","passPerPreset","node","jsxFragment","terser","keep_infinity","pure_getters","passes","wrap_func_args","warnings","ecma","toplevel","writeBundle","writeFile","all","values","fileName","results","paths","strict","freeze","esModule","banner","es","umd","passedInOption","processCssmodulesArgument","moduleAllCss","allowOnlySuffixModule","isWatchMode","hasPassedInScopeName","generateScopedName"],"mappings":"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"}